From de331d630229a84a81fb5412243e8af72f3d9d1e Mon Sep 17 00:00:00 2001
From: Ray Donnelly <mingw.android@gmail.com>
Date: Mon, 11 Jun 2018 00:24:44 +0100
Subject: [PATCH 16/18] Mimic OpenBLAS when making 'reference' Rblas and
 Rlapack dylibs

---
 configure    | 12 +++++++++---
 configure.ac | 11 ++++++++---
 2 files changed, 17 insertions(+), 6 deletions(-)

diff --git a/configure b/configure
index ffd9e35bca..ff982d0966 100755
--- a/configure
+++ b/configure
@@ -27777,9 +27777,15 @@ case "${host_os}" in
     dylib_ldflags="${darwin_dylib_ldflags}"
     MAJR_VERSION=`echo "${PACKAGE_VERSION}" | sed  -e "s/[\.][1-9]$/.0/"`
     LIBR_LDFLAGS="-install_name libR.dylib -compatibility_version ${MAJR_VERSION}  -current_version ${PACKAGE_VERSION}  -headerpad_max_install_names"
-    RLAPACK_LDFLAGS="-install_name libRlapack.dylib -compatibility_version ${MAJR_VERSION} -current_version ${PACKAGE_VERSION}  -headerpad_max_install_names"
-    ## don't use version in libRblas so we can replace it with any BLAS implementation
-    RBLAS_LDFLAGS="-install_name libRblas.dylib -headerpad_max_install_names"
+    if true; then
+      # Be very explicit to mimic OpenBLAS dylibs
+      RLAPACK_LDFLAGS="-install_name @rpath/libopenblas.dylib -compatibility_version 0.0.0  -current_version 0.0.0  -headerpad_max_install_names"
+      RBLAS_LDFLAGS="-install_name @rpath/libopenblas.dylib -compatibility_version 0.0.0  -current_version 0.0.0  -headerpad_max_install_names"
+    else
+      RLAPACK_LDFLAGS="-install_name libRlapack.dylib -compatibility_version ${MAJR_VERSION} -current_version ${PACKAGE_VERSION}  -headerpad_max_install_names"
+      ## don't use version in libRblas so we can replace it with any BLAS implementation
+      RBLAS_LDFLAGS="-install_name libRblas.dylib -headerpad_max_install_names"
+    fi
     ;;
   openbsd*)
     if test -z "${R_DYLIB_VERSION}"; then
diff --git a/configure.ac b/configure.ac
index 45162206e2..75c712be22 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1562,9 +1562,15 @@ dnl     ;;
     dylib_ldflags="${darwin_dylib_ldflags}"
     MAJR_VERSION=`echo "${PACKAGE_VERSION}" | sed  -e "s/[[\.]][[1-9]]$/.0/"` 
     LIBR_LDFLAGS="-install_name libR.dylib -compatibility_version ${MAJR_VERSION}  -current_version ${PACKAGE_VERSION}  -headerpad_max_install_names"
-    RLAPACK_LDFLAGS="-install_name libRlapack.dylib -compatibility_version ${MAJR_VERSION} -current_version ${PACKAGE_VERSION}  -headerpad_max_install_names"
-    ## don't use version in libRblas so we can replace it with any BLAS implementation
-    RBLAS_LDFLAGS="-install_name libRblas.dylib -headerpad_max_install_names"
+    if true; then
+      # Be very explicit to mimic OpenBLAS dylibs
+      RLAPACK_LDFLAGS="-install_name @rpath/libopenblas.dylib -compatibility_version 0.0.0  -current_version 0.0.0  -headerpad_max_install_names"
+      RBLAS_LDFLAGS="-install_name @rpath/libopenblas.dylib -compatibility_version 0.0.0  -current_version 0.0.0  -headerpad_max_install_names"
+    else
+      RLAPACK_LDFLAGS="-install_name libRlapack.dylib -compatibility_version ${MAJR_VERSION} -current_version ${PACKAGE_VERSION}  -headerpad_max_install_names"
+      ## don't use version in libRblas so we can replace it with any BLAS implementation
+      RBLAS_LDFLAGS="-install_name libRblas.dylib -headerpad_max_install_names"
+    fi
     ;;
 dnl   hpux*)
 dnl     ## Needs to avoid embedding a relative path ../../../bin.
-- 
2.20.1

